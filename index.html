<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>精仿音悦台</title>
	<link rel="stylesheet" href="css/index.css">
	<script>
	setRem();
	window.addEventListener('onorientationchange',function(){
		setRem();
		window.location.reload();
	});
	window.addEventListener('resize',function(){
		setRem();
		window.location.reload();
	});
	function setRem() {
		//设置设备的像素比
		var PixelRatio = 1/window.devicePixelRatio;
		document.write('<meta name="viewport" content="width=device-width, initial-scale='+PixelRatio+', minimum-scale='+PixelRatio+', maximum-scale='+PixelRatio+', user-scalable=no">');
		var  html = document.getElementsByTagName('html')[0];
		var  viewW = html.getBoundingClientRect().width;
		//设置根字体大小
		html.style.fontSize= viewW/16 + 'px';
	}
	
	</script>
</head>
<body>
	<section class="wrapper">
		<div class="top_wrap">
			<a class="logo" href="javascript:;"></a>
			<div id="channcel_btn" class="channcel_btn_show"></div>
			<div id="channcel_list" class="channcel_list list_hide">
				<ul>
					<li><a href="javascript:;">首页</a></li>
					<li><a href="javascript:;">MV</a></li>
					<li><a href="javascript:;">V榜</a></li>
					<li><a href="javascript:;">悦单</a></li>
					<li><a href="javascript:;">音悦</a></li>
					<li><a href="javascript:;">商城</a></li>
					<li><a href="javascript:;">节目</a></li>
					<li><a href="javascript:;">饭团</a></li>
					<li><a href="javascript:;">咨询</a></li>
					<li><a href="javascript:;">我的家</a></li>
					<li><a href="javascript:;">APP下载</a></li>
					<li><a href="javascript:;">热门应用</a></li>
				</ul>
			</div>
			<div class="right_btn_list">
				<a class="search_btn" href="javascript:;">搜索</a>
				<a href="javascript:;">登录</a>
				<a href="javascript:;">注册</a>
			</div>
		</div>
		<div class="search_wrap">
			<form action="/">
				<div class="inputSearch">
					<input type="text" placeholder="请输入搜索内容">
				</div>
				<button class="submitBtn" type="submit">搜索</button>
			</form>
		</div>
		<section class="main">
			<nav id="navScroll" class="navCon">
				<ul id="navList">
					<li class="active">
					          <a href="javascript:void(0);" class="selected" data-tab="index">首页</a>
					</li>
					<li>
					          <a href="javascript:void(0);" data-tab="mv">MV</a>
					</li>
					<li>
					          <a href="javascript:void(0);" data-tab="pl">悦单</a>
					 </li>
					 <li>
					          <a href="javascript:void(0);" data-tab="vchart">V榜</a>
					</li>
					<li>
					          <a href="http://shop.yinyuetai.com/">商城</a>
					 </li>
					<li>
						<a href="http://zhongchou.yinyuetai.com/wap">众筹</a></li>
					<li>
					          <a href="http://www.yinyuetai.com/fanMass" data-tab="wapfan">饭团</a>
					</li>
					<li>
					          <a href="javascript:void(0);" data-tab="program">节目</a>
					</li>
					<li>
					          <a href="javascript:void(0);" data-tab="stage">音悦stage</a>
					</li>
					<li>
					          <a href="javascript:void(0);" data-tab="apps/mobile">APP下载</a>
					</li>
					<li>
					          <a href="http://news.yinyuetai.com/" target="_blank">资讯</a>
					</li>
					<li>
					          <a href="http://i.yinyuetai.com" target="_blank">我的家</a>
					</li>
					<li>
					          <a href="javascript:void(0);" data-tab="apps">热门应用</a>
					</li>
				</ul>
			</nav>
			<div id="scrollWrap">
				<ul id="picList">
					<li><a href="#"><img src="img/b1.jpg"/></a></li>
					<li><a href="#"><img src="img/b2.jpg"/></a></li>
					<li><a href="#"><img src="img/b3.jpg"/></a></li>
					<li><a href="#"><img src="img/b4.jpg"/></a></li>
					<li><a href="#"><img src="img/b5.jpg"/></a></li>
				</ul>
				<div id="btn">
					<span class="active"></span>
					<span></span>
					<span></span>
					<span></span>
					<span></span>
				</div>
			</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
			<div>1111111111111111</div>
		</section>
	</section>
	<script src="js/transform.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		window.onload = function(){

			navTab();
			scrollPic();
			navScroll();
		}
		function navTab(){
			var oBtn = document.getElementById('channcel_btn');
			var oList = document.getElementById('channcel_list');
			var onOff = true;
			oBtn.addEventListener('touchstart',function(e){
				if(oBtn.className == 'channcel_btn_show'){
					oBtn.className = 'channcel_btn_close';
					oList.style.display="block";
				}else{
					oBtn.className = 'channcel_btn_show';
					oList.style.display="none";
				}
				e.stopPropagation();
			});
			document.addEventListener('touchstart',function(){
				if(oBtn.className == 'channcel_btn_close'){
					oBtn.className = 'channcel_btn_show';
					oList.style.display="none";
				}
				
			});
			oList.addEventListener('touchstart',function(e){
				e.stopPropagation();
			});
		}
		
		function scrollPic(){
			var oWrap = document.querySelector('#scrollWrap');
			var oList = document.querySelector('#picList');
			oList.innerHTML+=oList.innerHTML;
			var aLi = document.querySelectorAll('#picList li');
			var oNav = document.querySelectorAll('#btn span');
			var css = document.createElement('style');
			var timer = null;
			var iNow = 0;
			var style = '#scrollWrap{height:'+aLi[0].offsetHeight+'px;}';
				style+='#picList{width:'+aLi.length+'00%;}';
				style+='#picList li{width:'+1/aLi.length*100+'%;}';
				css.innerHTML+= style;
			document.head.appendChild(css);
			//手指的初始坐标
			var startPoint = 0;
			//元素初始移动的距离
			var startX = 0;
			cssTransform(oList,'translateX',0)
			
			autoPlay();
			
			oWrap.addEventListener('touchstart',function(e){
				clearInterval(timer);
				oList.style.WebkitTransition=oList.style.transition='none';
				var translateX = cssTransform(oList,'translateX');
				iNow = Math.round(-translateX/oWrap.offsetWidth);
				if(iNow==0){
					iNow=oNav.length;
				}
				if(iNow==aLi.length-1){
					iNow=oNav.length-1;
				}
				cssTransform(oList,'translateX',-iNow*oWrap.offsetWidth);
				startPoint = e.changedTouches[0].pageX;
				startX = cssTransform(oList,'translateX');
			});
			oWrap.addEventListener('touchmove',function(e){
				//当前移动位置的坐标
				var nowPoint = e.changedTouches[0].pageX;
				//初始位置与移动位置的差值，求出移动的距离
				var disX = nowPoint - startPoint;
				//元素总共移动的距离=之前的距离+当前移动的距离
				cssTransform(oList,'translateX',startX + disX);
			});
			oWrap.addEventListener('touchend',function(){
				var translateX = cssTransform(oList,'translateX');
				iNow = Math.round(-translateX/oWrap.offsetWidth);
				play();
				autoPlay();
			});
			//自动播放
			function autoPlay(){
				clearInterval(timer);
				timer = setInterval(function(){
					if(iNow==aLi.length-1){
						iNow=oNav.length-1;
					}
					oList.style.WebkitTransition=oList.style.transition='none';
					cssTransform(oList,'translateX',-iNow*oWrap.offsetWidth);
					iNow++;
					setTimeout(function(){
						play();
					},30);
				},2500);
			}
			
			function play(){
				oList.style.WebkitTransition=oList.style.transition='.5s';
				cssTransform(oList,'translateX',-iNow*oWrap.offsetWidth);
				for(var i=0,len = oNav.length;i<len;i++){
					oNav[i].className = '';
				}
				oNav[iNow%oNav.length].className = 'active';
			}
		}
		function navScroll(){
			var oNavscroll = document.querySelector('#navScroll');
			var oNavlist = document.querySelector('#navList');
			var oStartpoint = 0;
			var oStartX = 0;
			var minX = oNavscroll.clientWidth - oNavlist.offsetWidth;
			var step = 1;
			console.log(minX);
			oNavscroll.addEventListener('touchstart',function(e){
				oStartpoint = e.changedTouches[0].pageX;
				oStartX = cssTransform(oNavlist,'translateX');
				// console.log(oStartpoint,oStartX);
				step = 1;
			});
			oNavscroll.addEventListener('touchmove',function(e){
				var oNowpoint = e.changedTouches[0].pageX;
				var disX = oNowpoint - oStartpoint;
				// console.log(oNowpoint,disX);
				var moveLeft = oStartX+disX;
				if(moveLeft > 0){
					//计算拉动超出长度系数大小，超出越大 系数越小
					step = 1-moveLeft / oNavscroll.clientWidth+0.1;
					//设置滑动距离
					moveLeft = parseInt(moveLeft*step);
				}else if(moveLeft < minX){
					//计算超出值
					var over = minX - moveLeft;
					//根据超出值，计算拉动系数
					step = 1-over / oNavscroll.clientWidth+0.1;
					over = parseInt(over*step);
					//设置滑动距离
					moveLeft = minX - over;
				}
				cssTransform(oNavlist,'translateX',moveLeft);
			});
		}
	</script>
</body>
</html>